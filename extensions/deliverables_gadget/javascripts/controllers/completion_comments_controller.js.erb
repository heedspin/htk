function CompletionCommentsController(router) {
  HtkController.call(this, router);
  $("#htk-col2").on("click", ".htk-complete", $.proxy(this.newCompletionComment, this));
  $("#htkv-complete > form > button").click($.proxy(this.createCompletionComment, this));  
  $("#htkv-incomplete > form > button").click($.proxy(this.createCompletionComment, this));  
}
CompletionCommentsController.prototype = Object.create(HtkController.prototype);

CompletionCommentsController.prototype.newCompletionComment = function(event) {
  $("#htk-col3").children().hide();
  var deliverable = this.router.deliverablesController.deliverableTree.getDeliverable($(event.target).closest(".htk-show").attr("data-id"));
  var view = null;
  if (deliverable.isCompleted()) {
    view = $("#htkv-incomplete");
  } else {
    view = $("#htkv-complete");
  }
  view.find("input[name=deliverable_id]").val(deliverable.id);
  view.show();
}
CompletionCommentsController.prototype.createCompletionComment = function(event) {
  var _this = this;
  var form = $(event.target).parent();
  var values = form.formToNameValues();
  var comment = new DeliverableComment(values);
  htkLog("createCompletionComment: " + JSON.stringify(comment));
  comment.save({
    success: function(results) {
      _this.router.deliverablesController.deliverableChanged(results);
      _this.router.deliverablesController.showDeliverable();
      htkLog("Deliverable marked complete");
    },
    error: function(results) {
      htkLog("Failed to mark deliverable complete");
    }
  })
}
